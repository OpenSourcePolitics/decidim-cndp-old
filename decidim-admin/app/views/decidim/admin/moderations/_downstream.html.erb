<div class="card-section">
  <div class="table-scroll">
    <table class="table-list">
      <thead>
        <tr>
          <th><%= t("models.moderation.fields.reportable", scope: "decidim.moderations") %></th>
          <th><%= t("models.moderation.fields.reported_content_url", scope: "decidim.moderations") %></th>
          <th><%= t("models.moderation.fields.reports", scope: "decidim.moderations") %></th>
          <th><%= t("models.moderation.fields.report_count", scope: "decidim.moderations") %></th>
          <% if params[:hidden] %>
            <th><%= t("models.moderation.fields.hidden_at", scope: "decidim.moderations") %></th>
          <% end %>
          <th class="actions"><%= t("actions.title", scope: "decidim.moderations") %></th>
        </tr>
      </thead>
      <tbody>
        <% if downstream_moderations %>
          <% downstream_moderations.each do |moderation| %>
            <tr data-id="<%= moderation.id %>">
              <td>
                <%= moderation.reportable.class.name.demodulize %>
              </td>
              <td>
                <% if moderation.reportable.class.name.demodulize == "Comment"%>
                  <%=
                    link_to moderation.reportable.reported_content_url, target: "_blank" do
                    (moderation.reportable.reported_content_url).html_safe
                    end
                  %>
                  <%= icon_link_to "external-link", moderation.reportable.reported_content_url, truncate(moderation.reportable.body, length: 70) %>
                <% else %>
                 <%=
                   link_to moderation.reportable.reported_content_url, target: "_blank" do
                    (moderation.reportable.reported_content_url + " " + icon("external-link")).html_safe
                    end
                  %>
                <% end%>
              </td>
              <td>
                <% reports = moderation.reports.map { |report| render 'report', report: report } %>
                <%= safe_join(reports, ',') %>
              </td>
              <td>
                <%= moderation.report_count %>
              </td>
              <% if params[:hidden] %>
                <td>
                  <%= l(moderation.hidden_at, format: :short) if moderation.hidden_at.present? %>
                </td>
              <% end %>
              <td class="actions">

                <% if can? :unreport, moderation %>
                  <%= icon_link_to "action-undo",
                                   unreport_moderation_path(id: moderation),
                                   t("actions.unreport", scope: "decidim.moderations"),
                                   class: "action-icon--unreport",
                                   method: :put %>
                <% end %>
                <% if !moderation.reportable.hidden? && can?(:hide, moderation) %>
                  <%= icon_link_to "eye",
                                   hide_moderation_path(id: moderation),
                                   t("actions.hide", scope: "decidim.moderations"),
                                   class: "action-icon--hide",
                                   method: :put %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
